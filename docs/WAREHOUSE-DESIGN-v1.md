# 🎒 西瓜时钟 — 仓库与合成系统设计 v1

> 确认时间：2026-02-11
> 设计：小西
> 确认人：Charles Yu

## 设计背景

用户每次专注完成后获得收获物（种子/幼苗/花/小瓜/大西瓜），但目前这些收获物只是一个庆祝画面，没有被"留下来"。用户缺少积累感和成长感。

本方案引入"仓库"系统，让收获物可以被收集、查看、合成，给用户一个持续的目标。

## 核心理念

1. **每次专注都有实质收获** — 不只是看一眼庆祝动画，收获物会存入仓库，看得见摸得着
2. **合成是保底机制，不是主要路径** — 合成汇率故意设计得不划算，鼓励用户通过更长专注直接获得高阶收获物
3. **隐藏款制造惊喜** — ≥90 分钟专注有概率开出传说级收获物，稀有但不绝望
4. **不鼓励过度专注** — 90 分钟是生理上限（超日节律），不设更高阶奖励

---

## 一、专注时长与收获物（调整后）

基于科学研究（Andrew Huberman 超日节律研究、经典番茄工作法），调整时间阈值：

| 收获物 | 专注时长 | 阶段 | 科学依据 |
|--------|---------|------|---------|
| 🌱 种子 | 5-14 分钟 | seed | 碎片专注，热身阶段 |
| 🌿 幼苗 | 15-24 分钟 | sprout | 注意力开始稳定 |
| 🌼 花 | 25-44 分钟 | bloom | 经典番茄钟，最被验证的专注时长 |
| 🍈 小瓜 | 45-59 分钟 | green | 深度专注区间 |
| 🍉 大西瓜 | 60-89 分钟 | ripe | 1 小时深度工作 |
| 👑 金西瓜（隐藏款） | ≥ 90 分钟（10% 概率） | legendary | 超日节律上限，传说级 |

**注意：** < 5 分钟不给收获物（防止刷短专注）。

**与旧版对比：**
- 旧版：<10/10-15/15-20/20-25/≥25，间隔 5 分钟，太密
- 新版：间隔拉大，每个阶段有明确的"身份感"
- 花（25-44min）区间最宽，因为这是大多数用户的主力时长

---

## 二、隐藏款 — 金西瓜 👑

**触发条件：** 专注 ≥ 90 分钟

**概率：** 10%
- 没开出时：正常获得大西瓜 🍉（不亏）
- 开出时：获得金西瓜 👑 + 超级庆祝效果

**保底机制：** 连续 20 次 ≥90 分钟专注未开出 → 第 21 次必出
- 保底计数器存在 localStorage
- 防止极端倒霉的用户永远开不出

**概率设计理由：**
- 10% = 平均 10 次 90 分钟专注开出 1 次 ≈ 15 小时深度专注
- 太低（1-3%）→ 挫败感
- 太高（30%+）→ 没有稀有感
- 10% 是甜蜜点：稀有但不绝望

**庆祝效果（比大西瓜更隆重）：**
- 背景：全屏金色爆炸 + 彩虹光效
- 收获物：金西瓜图标居中，金色粒子环绕旋转
- 前景：满屏金色礼花 + 钻石般闪光
- 持续时间：8 秒（比大西瓜的 6 秒更长）
- 专属音效（后续加）
- 文案："传说中的金西瓜！你是专注大师 👑"

**后续可调：**
- 概率可根据数据调整（5%-20%）
- 可加入更多隐藏款（节日限定、季节限定等）

---

## 三、仓库系统

### 入口
- 主界面新增一个仓库入口按钮（建议放在 header 区域，用 🎒 或 📦 图标）
- 点击进入仓库页面

### 仓库页面布局

```
┌─────────────────────────────┐
│  🎒 我的仓库                 │
│                             │
│  ┌─────┐ ┌─────┐ ┌─────┐  │
│  │ 🌱  │ │ 🌿  │ │ 🌼  │  │
│  │ x42 │ │ x18 │ │ x7  │  │
│  └─────┘ └─────┘ └─────┘  │
│  ┌─────┐ ┌─────┐ ┌─────┐  │
│  │ 🍈  │ │ 🍉  │ │ 👑  │  │
│  │ x3  │ │ x1  │ │ x0  │  │
│  └─────┘ └─────┘ └─────┘  │
│                             │
│  ── 合成 ──                 │
│  [选择合成方案]              │
│                             │
│  ── 统计 ──                 │
│  总收获：71 个               │
│  最高阶：🍉 大西瓜           │
│  金西瓜：未解锁 🔒           │
└─────────────────────────────┘
```

### 仓库功能
1. **收获物展示** — 6 种收获物（含隐藏款），显示图标 + 数量
2. **金西瓜未获得时** — 显示为 🔒 + "???"，不提前剧透名字和图标
3. **合成入口** — 点击进入合成界面
4. **简单统计** — 总收获数、最高阶收获物

### 数据存储
- 使用 localStorage（与现有设置/历史记录一致）
- 数据结构：
```typescript
interface Warehouse {
  items: {
    seed: number;
    sprout: number;
    bloom: number;
    green: number;
    ripe: number;
    legendary: number;
  };
  legendaryPity: number;  // 保底计数器（连续未出金西瓜次数）
  totalCollected: number; // 历史总收获数
}
```

---

## 四、合成系统

### 合成链路

| 合成方向 | 所需数量 | 产出 | 等价专注时间 |
|---------|---------|------|------------|
| 🌱 种子 → 🌿 幼苗 | 20 个种子 | 1 个幼苗 | 100-280min vs 直接 15min |
| 🌿 幼苗 → 🌼 花 | 15 个幼苗 | 1 朵花 | 225-360min vs 直接 25min |
| 🌼 花 → 🍈 小瓜 | 10 朵花 | 1 个小瓜 | 250-440min vs 直接 45min |
| 🍈 小瓜 → 🍉 大西瓜 | 5 个小瓜 | 1 个大西瓜 | 225-295min vs 直接 60min |

**设计原则：**
- 合成代价约为直接专注的 3-5 倍，明显不划算
- 但给短专注用户一条出路：积少成多，不浪费
- 金西瓜 👑 不可合成（只能通过 ≥90 分钟专注 + 概率获得）

### 合成界面

```
┌─────────────────────────────┐
│  ⚗️ 合成                    │
│                             │
│  🌱 x20  →  🌿 x1          │
│  [你有 42 个种子]            │
│  [可合成 2 个幼苗]           │
│  [合成] [合成全部]           │
│                             │
│  🌿 x15  →  🌼 x1          │
│  [你有 18 个幼苗]            │
│  [可合成 1 朵花]             │
│  [合成]                     │
│                             │
│  🌼 x10  →  🍈 x1          │
│  [你有 7 朵花]               │
│  [数量不足 ❌]               │
│                             │
│  🍈 x5   →  🍉 x1          │
│  [你有 3 个小瓜]             │
│  [数量不足 ❌]               │
└─────────────────────────────┘
```

### 合成交互
- 点击"合成"按钮 → 播放合成动画（收获物汇聚 → 闪光 → 新物品出现）
- "合成全部"一键合成所有可合成的（方便批量操作）
- 数量不足时按钮置灰，显示还差多少
- 合成后仓库数量实时更新

---

## 五、专注完成流程（更新）

```
专注完成
  ↓
计算专注时长
  ↓
确定收获物阶段（seed/sprout/bloom/green/ripe）
  ↓
如果 ≥ 90 分钟：
  → 10% 概率：获得金西瓜 👑（重置保底计数器）
  → 90% 概率：获得大西瓜 🍉（保底计数器 +1）
  → 如果保底计数器 ≥ 20：必出金西瓜 👑
  ↓
收获物存入仓库（localStorage）
  ↓
播放庆祝动画（按阶段）
  ↓
进入休息
```

---

## 六、健康保护（后续版本）

- 超过 45 分钟时，温馨提示"记得活动一下身体 🧘"
- 超过 90 分钟时，不再给更高奖励，暗示"该休息了"
- 用户指南说明：鼓励"高质量专注"，不是"越长越好"

---

## 七、版本归属

本方案计划在 **v0.8.0** 实现：
- 仓库页面（展示 + 统计）
- 合成系统（4 条合成链路 + 动画）
- 专注时长阈值调整（新的 6 阶段）
- 隐藏款金西瓜（概率 + 保底 + 庆祝效果）
- 收获物自动存入仓库

**不包含：**
- 农场种植（v0.9+）
- 切瓜系统（v0.9+）
- 账号同步（v1.0）
