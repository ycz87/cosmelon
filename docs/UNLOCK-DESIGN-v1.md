# 🔓 逐步解锁系统 — 设计文档 v1

> 版本：v1.0 | 日期：2026-02-14
> 所属系统：全局系统
> 关联文档：[系统总览](OVERVIEW-v2.md) · [成就徽章](ACHIEVEMENT-DESIGN-v1.md)

## 定位

逐步解锁系统控制功能的**渐进式开放**，让新用户不被复杂功能吓跑，同时让每次专注都有"解锁新东西"的惊喜感。

核心原则：
- **第一次打开零门槛** — 一个按钮就能开始
- **每次解锁都是奖励** — 不是"终于能用了"，而是"又发现新东西了！"
- **老用户不受影响** — 已有用户默认全部解锁，不倒退体验

---

## 一、解锁节奏

| 解锁阶段 | 触发条件 | 解锁内容 | 解锁提示文案 |
|---------|---------|---------|------------|
| 🌱 起步 | 首次打开 APP | 基础计时器（25min 默认）+ 开始按钮 | "欢迎来到西瓜田！点击开始，种下你的第一颗西瓜 🍉" |
| 🌿 第 1 次完成 | 完成第 1 次专注 | 任务命名功能 + 今日统计 | "🎉 你可以给每次专注起个名字啦！" |
| 🌼 第 2 次完成 | 完成第 2 次专注 | 自定义时长（快捷选择器） | "⏱️ 解锁了！现在你可以自由调整专注时长" |
| 🍈 第 3 次完成 | 完成第 3 次专注 | 仓库入口（🎒 按钮） | "🎒 你的瓜棚开张了！看看你收获了什么" |
| 🍉 第 5 次完成 | 完成第 5 次专注 | 背景音混音器 | "🎵 解锁了背景音！试试边专注边听雨声？" |
| ⭐ 第 7 次完成 | 完成第 7 次专注 | 项目计时模式 | "📋 项目模式解锁！适合把大任务拆成小步骤" |
| 🎨 第 10 次完成 | 完成第 10 次专注 | 主题切换（5 套主题） | "🎨 新主题解锁！换个颜色换个心情" |
| 🏆 第 15 次完成 | 完成第 15 次专注 | 成就系统入口 | "🏆 成就系统开启！看看你已经达成了哪些成就" |
| 📊 第 20 次完成 | 完成第 20 次专注 | 历史记录 + 统计图表 | "📊 数据面板解锁！回顾你的专注旅程" |
| 🌐 第 25 次完成 | 完成第 25 次专注 | 多语言切换 | "🌐 多语言解锁！支持 8 种语言" |

> 第 25 次之后，所有功能全部开放，不再有解锁提示。

---

## 二、首次打开体验

### 新用户看到的界面

```
┌─────────────────────────────┐
│  🍉 西瓜时钟                  │
│                               │
│                               │
│        [进度环 25:00]          │
│                               │
│     🍉 种下你的第一颗西瓜      │
│                               │
│          [ ▶ 开始 ]           │
│                               │
│                               │
│  ─────────────────────────── │
│  🌱 今日收获                   │
│  还没有西瓜哦，开始专注吧！     │
└─────────────────────────────┘
```

**隐藏的元素（首次打开不显示）：**
- ❌ 任务输入框
- ❌ 时长快捷选择器
- ❌ 仓库按钮
- ❌ 项目模式切换
- ❌ 混音器入口
- ❌ 主题切换
- ❌ 成就入口
- ❌ 历史记录按钮
- ❌ 多语言切换

只有一个大大的进度环和一个开始按钮。**极致简洁。**

---

## 三、解锁动画

### 功能解锁时的视觉效果

每次解锁新功能时：

1. **专注完成庆祝动画正常播放**
2. **庆祝结束后，解锁提示从底部滑入**（300ms ease-out）

```
┌─────────────────────────────┐
│                               │
│  ┌───────────────────────┐   │
│  │  🔓 新功能解锁！        │   │
│  │                         │   │
│  │  [功能图标动画]          │   │
│  │  🎵 背景音混音器         │   │
│  │                         │   │
│  │  "试试边专注边听雨声？"  │   │
│  │                         │   │
│  │  [去看看]    [稍后]      │   │
│  └───────────────────────┘   │
└─────────────────────────────┘
```

### 动画细节
- 功能图标从 🔒 灰色 → 彩色解锁（0.6s）
- 解锁瞬间有轻微的弹跳效果（scale 0.8 → 1.05 → 1.0）
- 背景有淡淡的光晕扩散
- "去看看"按钮引导用户立即体验新功能
- "稍后"关闭提示，功能已解锁可随时使用

### 功能入口出现动画
新解锁的功能按钮/入口在界面上首次出现时：
- 从透明渐入（opacity 0 → 1，0.5s）
- 带一个小小的"NEW"角标（3 天后自动消失）
- 首次点击时角标消失

---

## 四、数据存储

### localStorage
```json
{
  "unlockProgress": {
    "totalCompletedSessions": 12,
    "unlockedFeatures": [
      "taskNaming",
      "customDuration",
      "warehouse",
      "ambience"
    ],
    "seenUnlocks": [
      "taskNaming",
      "customDuration",
      "warehouse",
      "ambience"
    ],
    "isVeteran": false
  }
}
```

### 老用户兼容
- 检测 localStorage 中是否已有 `pomodoro-records`（专注记录）
- 如果有记录 → `isVeteran = true` → 所有功能默认解锁，不显示解锁流程
- 如果没有记录 → 新用户，走逐步解锁流程

### 云端同步
- `unlockProgress` 纳入 user_settings 同步
- 新设备登录后，如果云端有解锁进度则同步过来

---

## 五、设置页的"重置引导"

在设置页底部（通用分组）加一个选项：
- **"重新体验解锁流程"** — 重置解锁进度，重新走一遍（不影响实际数据）
- 用途：用户想重温首次体验，或者想给朋友演示

---

## 六、与成就系统的联动

逐步解锁和成就系统天然配合：

| 解锁事件 | 对应成就 |
|---------|---------|
| 完成第 1 次专注 → 解锁任务命名 | 🔥 F1 "第一颗西瓜" |
| 完成第 3 次 → 解锁仓库 | 🍉 H1 "初次收获" |
| 完成第 7 次 → 解锁项目模式 | （无直接对应，但接近 S1 三天打卡） |
| 完成第 15 次 → 解锁成就系统 | 成就页面打开时，已解锁的成就一次性展示 |

当成就系统在第 15 次解锁时，用户打开成就页面会看到自己已经有好几个成就了（F1、F2、H1 等），有一种"原来我已经这么厉害了"的惊喜感。

---

## 七、边界情况

| 场景 | 处理方式 |
|------|---------|
| 用户清除浏览器数据 | 重新走解锁流程（无历史记录 = 新用户） |
| 用户登录后云端有进度 | 同步云端解锁进度，跳过已解锁的步骤 |
| 用户在 A 设备解锁了，B 设备没有 | 登录同步后 B 设备也解锁 |
| 用户不想要解锁流程 | 设置页可一键"跳过全部解锁"（全部开放） |
| 一次专注触发多个解锁 | 只显示最新解锁的那个（避免弹窗轰炸） |

---

## 八、实现优先级

这个系统的实现可以分两步：

**第一步（和成就系统一起做）：**
- 解锁进度追踪（totalCompletedSessions 计数）
- 功能显示/隐藏逻辑
- 老用户兼容检测
- 解锁提示弹窗（简单版，不需要复杂动画）

**第二步（打磨体验）：**
- 解锁动画效果
- "NEW"角标
- 首次打开的极简界面
- 设置页"重置引导"选项
